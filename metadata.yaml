# Copyright 2022-2023 Canonical Ltd.
# See LICENSE file for licensing details.

name: prometheus-pushgateway-k8s
assumes:
  - k8s-api

display-name: Prometheus Pushgateway Charmed Operator
summary: Prometheus Pushgateway for Kubernetes clusters.

description: |
  Prometheus Pushgateway is a service that allows ephemeral and batch jobs to expose their metrics to Prometheus.

  This charm deploys and operates Prometheus Pushgateway on Kubernetes clusters

containers:
  pushgateway:
    resource: pushgateway-image
    mounts:
      - storage: pushgateway-store
        location: /data

storage:
  pushgateway-store:
    type: filesystem
    description: Mount point in which Prometheus Pushgateway will store data

resources:
  pushgateway-image:
    type: oci-image
    description: OCI image for Prometheus Pushgateway
    # Included for simplicity in integration tests
    upstream-source: ghcr.io/canonical/prometheus-pushgateway:dev

provides:
  metrics-endpoint:
    interface: prometheus_scrape
  push-endpoint:
    interface: pushgateway

requires:
  certificates:
    interface: tls-certificates
    limit: 1
    description: |
      Obtain a CA and a server certificate for Prometheus to use for TLS.
      The same CA cert is used for all in-cluster requests, e.g.:
      - (client) scraping targets for self-monitoring
      - (client) posting alerts to alertmanager server
      - (server) serving data to grafana

peers:
  pushgateway-peers:
    interface: pushgateway_peers
